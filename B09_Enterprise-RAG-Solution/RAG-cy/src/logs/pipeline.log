/private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/.venv/bin/python /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/src/pipeline.py
root_path: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data
4. 将pdf转化为纯markdown文本
5. 将规整后报告分块，便于后续向量化，输出到 databases/chunked_reports
开始分割 /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/debug_data/03_reports_markdown 目录下的 markdown 文件...
已处理: 【财报】中芯国际：中芯国际2024年年度报告.md -> 【财报】中芯国际：中芯国际2024年年度报告.json
共分割 1 个 markdown 文件
分割完成，结果已保存到 /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/chunked_reports
6. 从分块报告创建向量数据库，输出到 databases/vector_dbs
Processing reports for FAISS:   0%|          | 0/1 [00:00<?, ?it/s]start embedding ================================
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
Processing reports for FAISS: 100%|██████████| 1/1 [01:05<00:00, 65.00s/it]
Processed 1 reports
Vector databases created in /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/vector_dbs
7. 处理问题并生成答案，具体逻辑取决于 run_config
Processing questions:   0%|          | 0/5 [00:00<?, ?it/s][VectorRetriever] vector_db_dir: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/vector_dbs, documents_dir: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/chunked_reports
[VectorRetriever] vector_db_dir: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/vector_dbs, documents_dir: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/chunked_reports
[VectorRetriever] vector_db_dir: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/vector_dbs, documents_dir: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/chunked_reports
[VectorRetriever] vector_db_dir: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/vector_dbs, documents_dir: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/chunked_reports
[HybridRetriever] vector_db_dir: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/vector_dbs, documents_dir: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/chunked_reports
[计时] [get_answer_for_company] 检索器初始化耗时: 0.15 秒
[计时] [HybridRetriever] 开始向量检索 ...
[HybridRetriever] vector_db_dir: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/vector_dbs, documents_dir: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/chunked_reports
[计时] [get_answer_for_company] 检索器初始化耗时: 0.15 秒
[计时] [HybridRetriever] 开始向量检索 ...
[HybridRetriever] vector_db_dir: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/vector_dbs, documents_dir: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/chunked_reports
[计时] [get_answer_for_company] 检索器初始化耗时: 0.15 秒
[计时] [HybridRetriever] 开始向量检索 ...
[HybridRetriever] vector_db_dir: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/vector_dbs, documents_dir: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/chunked_reports
[计时] [get_answer_for_company] 检索器初始化耗时: 0.15 秒
[计时] [HybridRetriever] 开始向量检索 ...
[计时] [HybridRetriever] 向量检索耗时: 1.67 秒
[计时] [HybridRetriever] 开始LLM重排 ...
[计时] [HybridRetriever] 向量检索耗时: 1.68 秒
[计时] [HybridRetriever] 开始LLM重排 ...
[计时] [HybridRetriever] 向量检索耗时: 1.77 秒
[计时] [HybridRetriever] 开始LLM重排 ...
[计时] [HybridRetriever] 向量检索耗时: 1.81 秒
[计时] [HybridRetriever] 开始LLM重排 ...
[计时] [HybridRetriever] LLM重排耗时: 23.95 秒
[计时] [HybridRetriever] 总耗时: 25.72 秒
[计时] [get_answer_for_company] 检索耗时: 25.72 秒
[计时] [get_answer_for_company] 构建rag_context耗时: 0.00 秒
BaseOpenaiProcessor#send_message, response: step_by_step_analysis='1. 问题要求分析中芯国际的营收和利润变化及影响因素。\n2. 根据年报信息，2024年营业收入较上年同期增长27.7%，净利润减少23.3%。\n3. 营业收入增加主要是由于晶圆销售数量增加和产品组合变动。\n4. 净利润下降可能受成本增加、市场价格变化等因素影响。\n5. 结合上下文，形成完整的回答，解释营收和利润变化及其影响因素。' reasoning_summary='年报显示营收增长27.7%，净利润下降23.3%，受晶圆销售数量增加和成本影响。' relevant_pages=[0] final_answer='2024年，中芯国际实现营业收入人民币57,795.6百万元，同比增加27.7%，而归属于上市公司股东的净利润为人民币3,698.7百万元，同比减少23.3%。营业收入的增加主要是由于晶圆销售数量增加和产品组合变动。净利润下降则与成本增加和市场环境变化有关。'
BaseOpenaiProcessor#send_message: {'model': 'gpt-4o-2024-08-06', 'input_tokens': 9969, 'output_tokens': 244}, content: {'step_by_step_analysis': '1. 问题要求分析中芯国际的营收和利润变化及影响因素。\n2. 根据年报信息，2024年营业收入较上年同期增长27.7%，净利润减少23.3%。\n3. 营业收入增加主要是由于晶圆销售数量增加和产品组合变动。\n4. 净利润下降可能受成本增加、市场价格变化等因素影响。\n5. 结合上下文，形成完整的回答，解释营收和利润变化及其影响因素。', 'reasoning_summary': '年报显示营收增长27.7%，净利润下降23.3%，受晶圆销售数量增加和成本影响。', 'relevant_pages': [0], 'final_answer': '2024年，中芯国际实现营业收入人民币57,795.6百万元，同比增加27.7%，而归属于上市公司股东的净利润为人民币3,698.7百万元，同比减少23.3%。营业收入的增加主要是由于晶圆销售数量增加和产品组合变动。净利润下降则与成本增加和市场环境变化有关。'}
[计时] [get_answer_for_company] LLM调用耗时: 5.47 秒
[计时] [get_answer_for_company] 总耗时: 31.34 秒
[计时] [HybridRetriever] LLM重排耗时: 30.61 秒
[计时] [HybridRetriever] 总耗时: 32.28 秒
[计时] [get_answer_for_company] 检索耗时: 32.28 秒
[计时] [get_answer_for_company] 构建rag_context耗时: 0.00 秒
[计时] [HybridRetriever] LLM重排耗时: 32.66 秒
[计时] [HybridRetriever] 总耗时: 34.33 秒
[计时] [get_answer_for_company] 检索耗时: 34.33 秒
[计时] [get_answer_for_company] 构建rag_context耗时: 0.00 秒
[计时] [HybridRetriever] LLM重排耗时: 33.23 秒
[计时] [HybridRetriever] 总耗时: 35.04 秒
[计时] [get_answer_for_company] 检索耗时: 35.04 秒
[计时] [get_answer_for_company] 构建rag_context耗时: 0.00 秒
BaseOpenaiProcessor#send_message, response: step_by_step_analysis='1. 问题询问中芯国际在晶圆制造行业中的地位以及服务范围和全球布局。\n2. 根据上下文，中芯国际是世界领先的集成电路晶圆代工企业之一，位居全球第二，中国大陆排名第一。\n3. 服务范围包括8英寸和12英寸晶圆代工、设计服务、IP支持、光掩模制造等。\n4. 全球布局方面，公司在美国、欧洲、日本和中国台湾设立市场推广办公室，构建国际化管理团队与运营网络。\n5. 综合以上信息，形成完整回答。' reasoning_summary='中芯国际在全球晶圆代工行业中排名第二，服务范围广泛，全球布局完善。' relevant_pages=[0] final_answer='中芯国际在晶圆制造行业中位居全球第二，是中国大陆的领导者。其服务范围包括8英寸和12英寸晶圆代工、设计服务与IP支持、光掩模制造等一站式配套服务。全球布局方面，公司在美国、欧洲、日本和中国台湾设立市场推广办公室，建立了辐射全球的服务基地与运营网络，构建紧密的集成电路产业生态。'
BaseOpenaiProcessor#send_message: {'model': 'gpt-4o-2024-08-06', 'input_tokens': 11811, 'output_tokens': 275}, content: {'step_by_step_analysis': '1. 问题询问中芯国际在晶圆制造行业中的地位以及服务范围和全球布局。\n2. 根据上下文，中芯国际是世界领先的集成电路晶圆代工企业之一，位居全球第二，中国大陆排名第一。\n3. 服务范围包括8英寸和12英寸晶圆代工、设计服务、IP支持、光掩模制造等。\n4. 全球布局方面，公司在美国、欧洲、日本和中国台湾设立市场推广办公室，构建国际化管理团队与运营网络。\n5. 综合以上信息，形成完整回答。', 'reasoning_summary': '中芯国际在全球晶圆代工行业中排名第二，服务范围广泛，全球布局完善。', 'relevant_pages': [0], 'final_answer': '中芯国际在晶圆制造行业中位居全球第二，是中国大陆的领导者。其服务范围包括8英寸和12英寸晶圆代工、设计服务与IP支持、光掩模制造等一站式配套服务。全球布局方面，公司在美国、欧洲、日本和中国台湾设立市场推广办公室，建立了辐射全球的服务基地与运营网络，构建紧密的集成电路产业生态。'}
[计时] [get_answer_for_company] LLM调用耗时: 6.04 秒
[计时] [get_answer_for_company] 总耗时: 38.47 秒
BaseOpenaiProcessor#send_message, response: step_by_step_analysis='1. 问题要求分析半导体行业的关键特性及其对中芯国际发展的助力。\n2. 根据年报内容，半导体行业是技术密集、人才密集和资金密集的行业，晶圆代工是核心环节，要求严格的管理和执行规范。\n3. 中芯国际具备卓越的研发技术实力、生产制造能力和服务体系，这些与行业特性高度契合。\n4. 这些特性帮助中芯国际形成品牌效应，获得客户资源，并在技术和市场上保持竞争优势。\n5. 结合以上分析，形成最终答案。' reasoning_summary='半导体行业的技术、人才和资金密集特性为中芯国际提供了技术研发和市场竞争优势。' relevant_pages=[0] final_answer='半导体行业具备高度的技术密集、人才密集和资金密集的特点。晶圆代工作为半导体产业链的核心环节，对生产环境、能源、原材料、设备和质量体系有严格的管理要求，涉及材料学、化学、光学、微电子等多学科。中芯国际通过其卓越的研发技术实力、强大的生产制造能力、完善的配套服务体系和丰富的市场实践经验，形成了明显的品牌效应。这些行业特性使中芯国际能够在市场中保持竞争优势，吸引广泛的客户资源，并推动其在全球集成电路制造业的领导地位。'
BaseOpenaiProcessor#send_message: {'model': 'gpt-4o-2024-08-06', 'input_tokens': 9593, 'output_tokens': 341}, content: {'step_by_step_analysis': '1. 问题要求分析半导体行业的关键特性及其对中芯国际发展的助力。\n2. 根据年报内容，半导体行业是技术密集、人才密集和资金密集的行业，晶圆代工是核心环节，要求严格的管理和执行规范。\n3. 中芯国际具备卓越的研发技术实力、生产制造能力和服务体系，这些与行业特性高度契合。\n4. 这些特性帮助中芯国际形成品牌效应，获得客户资源，并在技术和市场上保持竞争优势。\n5. 结合以上分析，形成最终答案。', 'reasoning_summary': '半导体行业的技术、人才和资金密集特性为中芯国际提供了技术研发和市场竞争优势。', 'relevant_pages': [0], 'final_answer': '半导体行业具备高度的技术密集、人才密集和资金密集的特点。晶圆代工作为半导体产业链的核心环节，对生产环境、能源、原材料、设备和质量体系有严格的管理要求，涉及材料学、化学、光学、微电子等多学科。中芯国际通过其卓越的研发技术实力、强大的生产制造能力、完善的配套服务体系和丰富的市场实践经验，形成了明显的品牌效应。这些行业特性使中芯国际能够在市场中保持竞争优势，吸引广泛的客户资源，并推动其在全球集成电路制造业的领导地位。'}
[计时] [get_answer_for_company] LLM调用耗时: 6.07 秒
[计时] [get_answer_for_company] 总耗时: 40.55 秒
BaseOpenaiProcessor#send_message, response: step_by_step_analysis='1. 问题询问中芯国际收入结构的变化，特别是中国大陆和北美市场的表现。\n2. 从年报中检索到相关数据，包括收入总额和地区收入占比。\n3. 2024年营业收入增加27.7%，其中晶圆代工业务增幅显著。\n4. 中国大陆市场收入占比从80.1%上升到84.6%，显示增长趋势。\n5. 美国市场收入占比从16.4%下降到12.4%，显示下降趋势。\n6. 总结出收入结构变化的主要表现和地区差异。' reasoning_summary='年报中详细列出收入结构的变化，尤其是中国大陆市场占比上升，美国市场占比下降。' relevant_pages=[0] final_answer='中芯国际的收入结构在2024年有显著变化，主要体现在晶圆销售数量的增加和产品组合的变动上。报告期内，公司实现营业收入57,795.6百万元，比上年增加27.7%。其中，集成电路晶圆代工业务收入为53,246.1百万元，同比增加30.3%。在地区表现上，中国大陆市场收入占比从上年的80.1%上升到84.6%，显示出强劲的增长。相比之下，美国市场收入占比从上年的16.4%下降到12.4%，表明北美市场的表现有所减弱。'
BaseOpenaiProcessor#send_message: {'model': 'gpt-4o-2024-08-06', 'input_tokens': 18865, 'output_tokens': 330}, content: {'step_by_step_analysis': '1. 问题询问中芯国际收入结构的变化，特别是中国大陆和北美市场的表现。\n2. 从年报中检索到相关数据，包括收入总额和地区收入占比。\n3. 2024年营业收入增加27.7%，其中晶圆代工业务增幅显著。\n4. 中国大陆市场收入占比从80.1%上升到84.6%，显示增长趋势。\n5. 美国市场收入占比从16.4%下降到12.4%，显示下降趋势。\n6. 总结出收入结构变化的主要表现和地区差异。', 'reasoning_summary': '年报中详细列出收入结构的变化，尤其是中国大陆市场占比上升，美国市场占比下降。', 'relevant_pages': [0], 'final_answer': '中芯国际的收入结构在2024年有显著变化，主要体现在晶圆销售数量的增加和产品组合的变动上。报告期内，公司实现营业收入57,795.6百万元，比上年增加27.7%。其中，集成电路晶圆代工业务收入为53,246.1百万元，同比增加30.3%。在地区表现上，中国大陆市场收入占比从上年的80.1%上升到84.6%，显示出强劲的增长。相比之下，美国市场收入占比从上年的16.4%下降到12.4%，表明北美市场的表现有所减弱。'}
[计时] [get_answer_for_company] LLM调用耗时: 7.14 秒
[计时] [get_answer_for_company] 总耗时: 42.32 秒
Processing questions:  80%|████████  | 4/5 [00:42<00:10, 10.58s/it][VectorRetriever] vector_db_dir: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/vector_dbs, documents_dir: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/chunked_reports
[HybridRetriever] vector_db_dir: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/vector_dbs, documents_dir: /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/databases/chunked_reports
[计时] [get_answer_for_company] 检索器初始化耗时: 0.04 秒
[计时] [HybridRetriever] 开始向量检索 ...
[计时] [HybridRetriever] 向量检索耗时: 1.64 秒
[计时] [HybridRetriever] 开始LLM重排 ...
[计时] [HybridRetriever] LLM重排耗时: 32.73 秒
[计时] [HybridRetriever] 总耗时: 34.37 秒
[计时] [get_answer_for_company] 检索耗时: 34.37 秒
[计时] [get_answer_for_company] 构建rag_context耗时: 0.00 秒
BaseOpenaiProcessor#send_message, response: step_by_step_analysis='1. 问题询问美国对中国半导体产业的限制政策对中芯国际的影响及应对措施。\n2. 从年报内容中，我们看到美国对中芯国际的限制包括将其列入实体清单，限制出口许可等。\n3. 这些限制可能导致中芯国际在研发、生产和业务方面面临挑战，特别是对先进技术节点的影响。\n4. 中芯国际通过自主研发、巩固自主化核心知识产权、引进人才等方式来应对这些限制。\n5. 年报中还提到中芯国际坚持开放合作，持续拓展产业链生态圈以增强竞争力。\n6. 结合这些信息，得出中芯国际在政策限制下的具体影响和应对策略。' reasoning_summary='美国限制政策影响中芯国际的技术发展，中芯国际通过自主研发和人才引进应对。' relevant_pages=[0] final_answer='美国对中国半导体产业的限制政策，包括将中芯国际列入实体清单和限制出口许可，给中芯国际带来了研发、生产和业务方面的挑战，尤其影响了其在先进技术节点上的发展。中芯国际通过加强自主研发、巩固自主化核心知识产权、引进人才，并拓展产业链生态圈来应对这些限制，以保持竞争力和市场份额。'
BaseOpenaiProcessor#send_message: {'model': 'gpt-4o-2024-08-06', 'input_tokens': 10548, 'output_tokens': 311}, content: {'step_by_step_analysis': '1. 问题询问美国对中国半导体产业的限制政策对中芯国际的影响及应对措施。\n2. 从年报内容中，我们看到美国对中芯国际的限制包括将其列入实体清单，限制出口许可等。\n3. 这些限制可能导致中芯国际在研发、生产和业务方面面临挑战，特别是对先进技术节点的影响。\n4. 中芯国际通过自主研发、巩固自主化核心知识产权、引进人才等方式来应对这些限制。\n5. 年报中还提到中芯国际坚持开放合作，持续拓展产业链生态圈以增强竞争力。\n6. 结合这些信息，得出中芯国际在政策限制下的具体影响和应对策略。', 'reasoning_summary': '美国限制政策影响中芯国际的技术发展，中芯国际通过自主研发和人才引进应对。', 'relevant_pages': [0], 'final_answer': '美国对中国半导体产业的限制政策，包括将中芯国际列入实体清单和限制出口许可，给中芯国际带来了研发、生产和业务方面的挑战，尤其影响了其在先进技术节点上的发展。中芯国际通过加强自主研发、巩固自主化核心知识产权、引进人才，并拓展产业链生态圈来应对这些限制，以保持竞争力和市场份额。'}
[计时] [get_answer_for_company] LLM调用耗时: 6.31 秒
[计时] [get_answer_for_company] 总耗时: 40.71 秒

Final Processing Statistics:
Total questions: 5
Errors: 0 (0.0%)
N/A answers: 0 (0.0%)
Successfully answered: 5 (100.0%)

Answers saved to /private/var/www/github/Arthur-AiEra/LLM-Lab/B09_Enterprise-RAG-Solution/RAG-cy/data/stock_data/answers_gpt-4o-2024-08-06.json
完成
Processing questions: 100%|██████████| 5/5 [01:23<00:00, 16.61s/it]

Process finished with exit code 0
